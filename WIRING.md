# Подключение и распиновка

Ниже — актуальные пины из `main/board/board_pins.h`. Если используете другую плату или разводку, меняйте этот файл.

## Общие советы

- Логика ESP32 — 3.3V.
- Общий GND обязателен для всех модулей.
- Дисплей, SD и DAC лучше питать от стабильного источника.
- На каждом модуле обязателен развязывающий конденсатор 0.1 мкФ между VCC и GND (как можно ближе к модулю).
- Разводите I2C и SPI физически отдельно: не кладите SDA/SCL рядом с линиями SPI и I2S.
- Линии LED‑ленты и SD‑SPI лучше уводить подальше от FM‑модуля и его антенны.
- Добавьте TVS‑защиту на питание и линии, выходящие на разъёмы (SD, питание, внешние кнопки).
- Рекомендуется предохранитель/полипредохранитель по входу питания.

## Дисплей 4x7-seg через 74HC595

| Сигнал | GPIO | Примечание |
|---|---:|---|
| DATA | 27 | `PIN_SR_DATA` |
| CLK  | 26 | `PIN_SR_CLK` |
| LATCH | 25 | `PIN_SR_LATCH` |
| OE (опц.) | 16 | `PIN_SR_OE`, активный LOW |

- Если OE не подключён — яркость программная.
- Полярность сегментов задаётся `DISPLAY_SEGMENT_ACTIVE_LOW`.

## I2S DAC (PCM5102)

| Сигнал | GPIO | Примечание |
|---|---:|---|
| BCLK | 14 | `PIN_I2S_BCLK` |
| WS/LRCK | 12 | `PIN_I2S_WS` |
| DOUT | 13 | `PIN_I2S_DOUT` |

## SD карта (SPI)

| Сигнал | GPIO | Примечание |
|---|---:|---|
| CS | 5 | `PIN_SD_CS` |
| MOSI | 23 | `PIN_SD_MOSI` |
| MISO | 19 | `PIN_SD_MISO` |
| SCK | 18 | `PIN_SD_CLK` |

Рекомендации:
- Держите линии SPI короткими и вдали от I2C (SDA/SCL).
- Если SD работает нестабильно — добавьте серию 33–100 Ом на линиях MOSI/SCK.

## FM‑радио (RDA5807M, I2C)

| Сигнал | GPIO | Примечание |
|---|---:|---|
| SCL | 32 | `PIN_RADIO_SCL` |
| SDA | 33 | `PIN_RADIO_SDA` |

- Нужен общий GND и стабильное 3.3V питание.
- Рекомендуется держать антенну/модуль подальше от LED‑ленты и I2S линий.
- Подтяжки I2C обязательны: 4.7–10 кОм на SDA/SCL к 3.3V (если нет на модуле).
- Если рядом длинные провода — добавьте 100 Ом последовательно в SDA/SCL.

## Адресная лента

| Сигнал | GPIO |
|---|---:|
| DATA | 4 |

Рекомендации:
- Лента создаёт сильные помехи — держите её провод подальше от FM‑модуля и I2C.
- Если возможно, используйте отдельный источник питания и общую землю в одной точке.

## Энкодер

| Сигнал | GPIO |
|---|---:|
| A | 21 |
| B | 22 |
| BTN | 17 |

## ADC клавиши (резистивная лестница)

По умолчанию отключены (GPIO_NC). Чтобы использовать:
- Назначьте реальный GPIO в `PIN_ADC_KEYS`.
- Убедитесь, что он соответствует `ADC_CHANNEL_4`.

## Датчик питания

`PIN_POWER_SENSE` сейчас `GPIO_NC` — можно подключить при необходимости.

---

Если нужно изменить распиновку — правьте `main/board/board_pins.h` и пересобирайте проект.
